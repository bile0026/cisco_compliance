{% extends 'compliance_template.j2' %}
# set services
service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
no service call-home
no service dhcp

logging buffered 512000

enable secret 5 {{ enable_pass }}
username {{ local_user }} privilege 15 secret 5 {{ local_pass }}

# aaa commands
aaa new-model
aaa authentication login default group tacacs+ local
aaa authorization config-commands
aaa authorization exec default group tacacs+ local if-authenticated
aaa authorization commands 1 default group tacacs+ if-authenticated
aaa authorization commands 15 default group tacacs+ local if-authenticated
aaa accounting update periodic 5
aaa accounting commands 1 default start-stop group tacacs+
aaa accounting commands 15 default start-stop group tacacs+
aaa session-id common

#set timezone
clock timezone EST -5 0
clock summer-time EDT recurring

{% if ansible_net_model == 'WS-C3560CX-12PC-S' or ansible_net_model == 'WS-C3560CG-8PC-S' %}
system mtu routing 1500
{% endif %}

{% if ansible_net_model == 'WS-C3560CX-12PC-S' or ansible_net_model == 'WS-C3560CG-8PC-S' %}
no ip domain-lookup
ip domain-name {{ domain_name }}
{% elif ansible_net_model == 'IOSv' %}
no ip domain-lookup
ip domain-name {{ domain_name }}
{% else %}
no ip domain lookup
ip domain name {{ domain_name }}
{% endif %}

# vtp off
vtp mode off
vtp domain {{ ansible_net_hostname }}

spanning-tree mode rapid-pvst
spanning-tree extend system-id

udld aggressive

archive
 log config
  logging enable
  notify syslog contenttype plaintext
  hidekeys

errdisable recovery cause udld
errdisable recovery cause security-violation
errdisable recovery cause channel-misconfig
errdisable recovery cause link-flap
errdisable recovery cause sfp-config-mismatch
errdisable recovery cause gbic-invalid
errdisable recovery cause psecure-violation
errdisable recovery cause port-mode-failure
errdisable recovery cause storm-control
errdisable recovery cause inline-power
errdisable recovery interval 600

no ip forward-protocol nd
# ip tacacs source-interface {{ management_interface }}

# service settings
no ip http server
no ip http secure-server
ip ssh version 2
ip scp server enable

ip access-list standard PROTECT_SNMP
{% for acl in protect_snmp_var %}}
 {{ acl }}
{% endfor %}}

ip access-list extended PROTECT_SSH
 permit tcp 10.0.0.0 0.255.255.255 any eq 22
 deny   ip any any log

logging facility local6
logging source-interface {{ management_interface }}
{% for server in syslog_server %}
logging host {{ server }}
{% endfor %}}
{% if ansible_net_hostname.startswith('2PS') %}
logging host 10.206.180.240
{% endif %}
{% if ansible_net_hostname.startswith('BAB') %}
logging host 10.101.0.240
{% endif %}
{% if ansible_net_hostname.startswith('CAN') %}
logging host 10.204.180.249
{% endif %}
{% if ansible_net_hostname.startswith('CLE') %}
logging host 10.206.180.240
{% endif %}
{% if ansible_net_hostname.startswith('COT') %}
logging host 10.41.0.240
{% endif %}
{% if ansible_net_hostname.startswith('CTG') %}
logging host 10.41.0.240
{% endif %}
{% if ansible_net_hostname.startswith('EGL') %}
logging host 10.41.0.240
{% endif %}
{% if ansible_net_hostname.startswith('EMP') %}
logging host 10.41.0.240
{% endif %}
{% if ansible_net_hostname.startswith('ERI') %}
logging host 10.204.180.249
{% endif %}
{% if ansible_net_hostname.startswith('EVE') %}
logging host 10.50.0.240
{% endif %}
{% if ansible_net_hostname.startswith('FRB') %}
logging host 10.50.0.240
{% endif %}
{% if ansible_net_hostname.startswith('ORD') %}
logging host 10.41.0.240
{% endif %}
{% if ansible_net_hostname.startswith('SIL') %}
logging host 10.101.0.240
{% endif %}
{% if ansible_net_hostname.startswith('TIL') %}
logging host 10.41.0.240
{% endif %}
{% if ansible_net_hostname.startswith('TOL') %}
logging host 10.206.180.240
{% endif %}
{% if ansible_net_hostname.startswith('WSY') %}
logging host 10.41.0.240
{% endif %}



# snmp config
snmp-server community {{ snmp_ro }} RO PROTECT_SNMP
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
{% if ansible_net_model == 'WS-C3560CX-12PC-S' or ansible_net_model == 'WS-C3560CG-8PC-S' %}
snmp-server enable traps transceiver all
snmp-server enable traps entity
snmp-server enable traps cpu threshold
snmp-server enable traps tty
snmp-server enable traps config
snmp-server enable traps envmon fan shutdown supply temperature status
snmp mib flash cache
{% endif %}

# TACACS config
{% for server in tacacs_server_name %}
 tacacs server {{ server.name }}
 address ipv4 {{ server.ip }}
 key 7 {{ tacacs_key }}
 timeout 2
{% endfor %}

banner login ^
{{ banner }}
^

# ntp source {{ management_interface }}
ntp server {{ ntp_address }}

line con 0
 exec-timeout 15 0
 logging synchronous

line vty 0 4
 access-class PROTECT_SSH in
 exec-timeout 15 0
 logging synchronous
 transport input ssh

line vty 5 15
 access-class PROTECT_SSH in
 exec-timeout 15 0
 logging synchronous
 transport input ssh